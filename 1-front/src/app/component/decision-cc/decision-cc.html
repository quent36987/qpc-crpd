<div class="search-container">
  <div class="search-header">
    <h1>Recherche de D√©cisions QPC du Conseil Constitutionnel</h1>
    <p>Utilisez les filtres ci-dessous pour affiner votre recherche</p>
  </div>

  <div class="search-content" [class.results-view]="showResults">
    <form class="search-form" [class.collapsed]="showResults" (ngSubmit)="onSearch()">
      <div class="form-header" (click)="toggleForm()" *ngIf="showResults">
        <h2>Crit√®res de recherche</h2>
        <span class="toggle-icon">{{ formCollapsed ? '‚ñº' : '‚ñ≤' }}</span>
      </div>

      <div class="form-content" [class.hidden]="formCollapsed && showResults">
        <!-- Ligne 1 : num√©ro / r√©f CC -->
        <div class="form-row">
          <div class="form-group">
            <label>Num√©ro</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.numero"
              name="numero"
              placeholder="Ex: 2024-001">
          </div>

          <div class="form-group">
            <label>R√©f. de la d√©cision du CC</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.referenceDecisionConseil"
              name="referenceDecisionConseil"
              placeholder="Ex: 2024-1001 QPC">
          </div>
        </div>

        <!-- Ligne 2 : r√©f transmission / origine -->
        <div class="form-row">
          <div class="form-group">
            <label>R√©f. d√©cision de transmission</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.referenceDecisionTransmission"
              name="referenceDecisionTransmission"
              placeholder="Ex: CE, 2024-02-10">
          </div>

          <div class="form-group">
            <label>Origine</label>
            <app-multi-select
              [options]="options.origines"
              [(selectedItems)]="searchCriteria.originesQpcIds"
              placeholder="S√©lectionner origine(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 3 : identit√© / qualit√© auteurs -->
        <div class="form-row">
          <div class="form-group">
            <label>Identit√©(s) de(s) l'auteur(s) de la QPC</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.identiteDemandeur"
              name="identiteDemandeur"
              placeholder="Ex: M. Dupont">
          </div>

          <div class="form-group">
            <label>Cat√©gorie des auteurs de QPC</label>
            <app-multi-select
              [options]="options.qualitesDemandeur"
              [(selectedItems)]="searchCriteria.qualitesDemandeurIds"
              placeholder="S√©lectionner qualit√©(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 4 : droits / qualit√© tiers -->
        <div class="form-row">
          <div class="form-group">
            <label>Droit(s) et libert√©(s) invoqu√©(s)</label>
            <app-multi-select
              [options]="options.droitsLibertes"
              [(selectedItems)]="searchCriteria.droitsLibertesIds"
              placeholder="S√©lectionner libert√©(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Qualit√© du/des tiers intervenants</label>
            <app-multi-select
              [options]="options.qualitesTiers"
              [(selectedItems)]="searchCriteria.qualitesTiersInterventionIds"
              placeholder="S√©lectionner qualit√©(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 5 : dates -->
        <div class="form-row">
          <div class="form-group">
            <label>Date - De</label>
            <input
              type="date"
              [(ngModel)]="searchCriteria.dateDecisionFrom"
              name="dateDecisionFrom">
          </div>

          <div class="form-group">
            <label>Date - √Ä</label>
            <input
              type="date"
              [(ngModel)]="searchCriteria.dateDecisionTo"
              name="dateDecisionTo">
          </div>
        </div>

        <!-- Ligne 6 : mati√®re / dispositif -->
        <div class="form-row">
          <div class="form-group">
            <label>Mati√®re</label>
            <app-multi-select
              [options]="options.matieres"
              [(selectedItems)]="searchCriteria.matieresIds"
              placeholder="S√©lectionner mati√®re(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Dispositif</label>
            <app-multi-select
              [options]="options.dispositifs"
              [(selectedItems)]="searchCriteria.dispositifsDecisionCcIds"
              placeholder="S√©lectionner dispositif(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 7 : d√©lai abrogation / traitements effets pass√©s -->
        <div class="form-row">
          <div class="form-group">
            <label>D√©lai avant abrogation (en mois)</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.delaiAvantAbrogationExpression"
              name="delaiAvantAbrogationExpression"
              placeholder="Ex: >6 ou =12">
            <small>Op√©rateurs possibles: &lt;, &lt;=, &gt;, &gt;=, &lt;&gt;, =</small>
          </div>

          <div class="form-group">
            <label>Traitement des effets pass√©s</label>
            <app-multi-select
              [options]="options.traitementsEffetsPasses"
              [(selectedItems)]="searchCriteria.traitementsEffetsPassesIds"
              placeholder="S√©lectionner traitement(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 8 : interventions -->
        <div class="form-row">
          <div class="form-group">
            <label>Nombre exact d'interventions admises</label>
            <input
              type="number"
              [(ngModel)]="searchCriteria.nombreInterventionsExact"
              name="nombreInterventionsExact"
              placeholder="Nombre exact">
          </div>

          <div class="form-group">
            <label>Ou entre</label>
            <div class="input-group">
              <input
                type="number"
                [(ngModel)]="searchCriteria.nombreInterventionsMin"
                name="nombreInterventionsMin"
                placeholder="Min">
              <span>et</span>
              <input
                type="number"
                [(ngModel)]="searchCriteria.nombreInterventionsMax"
                name="nombreInterventionsMax"
                placeholder="Max">
            </div>
          </div>
        </div>

        <!-- Ligne 9 : nb membres / demande r√©cusation -->
        <div class="form-row">
          <div class="form-group">
            <label>Nombre de membres si√©geant</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.nombreMembresSieges"
                  name="nombreMembresSieges"
                  [value]="6">
                6
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.nombreMembresSieges"
                  name="nombreMembresSieges"
                  [value]="7">
                7
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.nombreMembresSieges"
                  name="nombreMembresSieges"
                  [value]="8">
                8
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.nombreMembresSieges"
                  name="nombreMembresSieges"
                  [value]="9">
                9
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.nombreMembresSieges"
                  name="nombreMembresSieges"
                  [value]="10">
                10
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Demande de r√©cusation</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.demandeRecusation"
                  name="demandeRecusation"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.demandeRecusation"
                  name="demandeRecusation"
                  [value]="false">
                Non
              </label>
            </div>
          </div>
        </div>

        <!-- Ligne 10 : d√©port / nom membre -->
        <div class="form-row">
          <div class="form-group">
            <label>D√©port</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.deport"
                  name="deport"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.deport"
                  name="deport"
                  [value]="false">
                Non
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Nom du membre d√©port√©/r√©cus√©</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.nomMembreDeporteOuRecuse"
              name="nomMembreDeporteOuRecuse"
              placeholder="Ex: M. Martin">
          </div>
        </div>

        <!-- Ligne 11 : th√©orie / r√©serve d'opportunit√© -->
        <div class="form-row">
          <div class="form-group">
            <label>Th√©orie changement de circonstances</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.applicationTheorieChangementCirconstances"
                  name="applicationTheorieChangementCirconstances"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.applicationTheorieChangementCirconstances"
                  name="applicationTheorieChangementCirconstances"
                  [value]="false">
                Non
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>R√©serve d'opportunit√©</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.reserveOpportunite"
                  name="reserveOpportunite"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.reserveOpportunite"
                  name="reserveOpportunite"
                  [value]="false">
                Non
              </label>
            </div>
          </div>
        </div>

        <!-- Ligne 12 : r√©serve incomp / interpr√©tation -->
        <div class="form-row">
          <div class="form-group">
            <label>R√©serve d'incomp√©tence</label>
            <app-multi-select
              [options]="options.reservesIncompetence"
              [(selectedItems)]="searchCriteria.reservesIncompetenceConseilIds"
              placeholder="S√©lectionner r√©serve(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Interpr√©tation de la jurisprudence</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.interpretationJurisprudence"
                  name="interpretationJurisprudence"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.interpretationJurisprudence"
                  name="interpretationJurisprudence"
                  [value]="false">
                Non
              </label>
            </div>
          </div>
        </div>

        <!-- Ligne 13 : techniques / motifs -->
        <div class="form-row">
          <div class="form-group">
            <label>Technique de contr√¥le</label>
            <app-multi-select
              [options]="options.techniquesControle"
              [(selectedItems)]="searchCriteria.techniquesControle"
              placeholder="S√©lectionner technique(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Motif d'inconstitutionnalit√©</label>
            <app-multi-select
              [options]="options.motifsInconstitutionnalite"
              [(selectedItems)]="searchCriteria.motifsInconstitutionnalite"
              placeholder="S√©lectionner motif(s)...">
            </app-multi-select>
          </div>
        </div>

        <!-- Ligne 14 : remarque / caract√®re notable -->
        <div class="form-row">
          <div class="form-group">
            <label>Remarque</label>
            <input
              type="text"
              [(ngModel)]="searchCriteria.remarque"
              name="remarque"
              placeholder="Rechercher dans les remarques">
          </div>

          <div class="form-group">
            <label>Caract√®re notable de la d√©cision</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.caractereNotableDecision"
                  name="caractereNotableDecision"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.caractereNotableDecision"
                  name="caractereNotableDecision"
                  [value]="false">
                Non
              </label>
            </div>
          </div>
        </div>

        <!-- Ligne 15 : oralit√© -->
        <div class="form-row">
          <div class="form-group">
            <label>Oralit√©</label>
            <div class="radio-group-inline">
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.oralite"
                  name="oralite"
                  [value]="true">
                Oui
              </label>
              <label class="radio-label">
                <input
                  type="radio"
                  [(ngModel)]="searchCriteria.oralite"
                  name="oralite"
                  [value]="false">
                Non
              </label>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">üîç Rechercher</span>
            <span *ngIf="isLoading">Recherche en cours...</span>
          </button>
          <button
            type="button"
            class="btn-secondary"
            (click)="resetForm()"
            [disabled]="isLoading">
            ‚Ü∫ R√©initialiser
          </button>
        </div>
      </div>
    </form>

    <!-- R√©sultats -->
    <div class="results-section" *ngIf="showResults">
      <div class="results-header">
        <h2>R√©sultats de recherche</h2>
        <p class="results-count">
          {{ searchResult?.totalElements || 0 }} d√©cision(s) trouv√©e(s)
        </p>
      </div>

      <div class="table-container">
        <table class="results-table">
          <thead>
          <tr>
            <th>Num√©ro</th>
            <th>R√©f√©rence CC</th>
            <th>Date</th>
            <th>Origine</th>
            <th>Dispositif</th>
            <th>Mati√®re</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let decision of (searchResult?.content || [])">
            <td>{{ decision.numero }}</td>
            <td>{{ decision.referenceDecisionConseil }}</td>
            <td>{{ decision.dateDecision | date: 'dd/MM/yyyy' }}</td>
            <td>{{ decision.origineQpc }}</td>
            <td>
<!--              <span class="badge"-->
<!--                    [class.badge-success]="decision.dispositifDecisionCc === 'Conformit√©'"-->
<!--                    [class.badge-warning]="decision.dispositifDecisionCc?.includes('sous r√©serve')"-->
<!--                    [class.badge-danger]="decision.dispositifDecisionCc?.includes('Non-conformit√©')">-->
                {{ decision.dispositifDecisionCc }}
<!--              </span>-->
            </td>
            <td>{{ decision.matiere }}</td>
            <td>
              <button class="btn-view" (click)="viewDetails(decision)">üëÅ Voir</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="searchResult">
        <button
          class="btn-page"
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1">
          ‚Üê Pr√©c√©dent
        </button>
        <div class="page-info">
          Page {{ currentPage }} sur {{ totalPages() }}
        </div>
        <button
          class="btn-page"
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages()">
          Suivant ‚Üí
        </button>
      </div>
    </div>
  </div>

  <!-- Modal d√©tails -->
  <div class="modal" *ngIf="selectedDecision" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>D√©tails de la d√©cision</h2>
        <button class="close-btn" (click)="closeDetails()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="detail-section">
          <h3>Informations g√©n√©rales</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Num√©ro:</strong>
              <span>{{ selectedDecision?.numero }}</span>
            </div>
            <div class="detail-item">
              <strong>R√©f√©rence CC:</strong>
              <span>{{ selectedDecision?.referenceDecisionConseil }}</span>
            </div>
            <div class="detail-item">
              <strong>Date:</strong>
              <span>{{ selectedDecision?.dateDecision | date: 'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <strong>Origine:</strong>
              <span>{{ selectedDecision?.origineQpc }}</span>
            </div>
            <div class="detail-item">
              <strong>R√©f. transmission:</strong>
              <span>{{ selectedDecision?.referenceDecisionTransmission }}</span>
            </div>
            <div class="detail-item">
              <strong>Mati√®re:</strong>
              <span>{{ selectedDecision?.matiere }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Demandeur</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Identit√©:</strong>
              <span>{{ selectedDecision?.identiteDemandeur }}</span>
            </div>
            <div class="detail-item">
              <strong>Qualit√©:</strong>
              <span>{{ selectedDecision?.qualiteDemandeur }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Dispositions contest√©es</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Dispositions:</strong>
              <span>{{ selectedDecision?.dispositionsLegislativesContestees }}</span>
            </div>
            <div class="detail-item">
              <strong>Type:</strong>
              <span>{{ selectedDecision?.typeDispositionLegislative }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>D√©cision</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Dispositif:</strong>
<!--              <span class="badge"-->
<!--                    [class.badge-success]="selectedDecision?.dispositifDecisionCc === 'Conformit√©'"-->
<!--                    [class.badge-warning]="selectedDecision?.dispositifDecisionCc?.includes('sous r√©serve')"-->
<!--                    [class.badge-danger]="selectedDecision?.dispositifDecisionCc?.includes('Non-conformit√©')">-->
                {{ selectedDecision?.dispositifDecisionCc }}

            </div>
            <div class="detail-item" *ngIf="selectedDecision?.delaiAvantAbrogationMois">
              <strong>D√©lai avant abrogation:</strong>
              <span>{{ selectedDecision?.delaiAvantAbrogationMois }} mois</span>
            </div>
            <div class="detail-item">
              <strong>Traitement effets pass√©s:</strong>
              <span>{{ selectedDecision?.traitementEffetsPasses }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Composition et proc√©dure</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Membres si√©geant:</strong>
              <span>{{ selectedDecision?.nombreMembresSieges }}</span>
            </div>
            <div class="detail-item">
              <strong>Demande r√©cusation:</strong>
              <span>{{ selectedDecision?.demandeRecusation ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="detail-item">
              <strong>D√©port:</strong>
              <span>{{ selectedDecision?.deport ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDecision?.nomMembreDeporteOuRecuse">
              <strong>Membre d√©port√©/r√©cus√©:</strong>
              <span>{{ selectedDecision?.nomMembreDeporteOuRecuse }}</span>
            </div>
            <div class="detail-item">
              <strong>Oralit√©:</strong>
              <span>{{ selectedDecision?.oralite ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="detail-item">
              <strong>Interventions admises:</strong>
              <span>{{ selectedDecision?.nombreInterventionsAdmises }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Contr√¥le</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Technique:</strong>
              <span>{{ selectedDecision?.techniquesControle }}</span>
            </div>
            <div class="detail-item">
              <strong>Motif:</strong>
              <span>{{ selectedDecision?.motifInconstitutionnalite }}</span>
            </div>
            <div class="detail-item">
              <strong>Th√©orie changement:</strong>
              <span>{{ selectedDecision?.applicationTheorieChangementCirconstances ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="detail-item">
              <strong>R√©serve opportunit√©:</strong>
              <span>{{ selectedDecision?.reserveOpportunite ? 'Oui' : 'Non' }}</span>
            </div>
            <div class="detail-item">
              <strong>R√©serve incomp√©tence:</strong>
              <span>{{ selectedDecision?.reserveIncompetenceConseil }}</span>
            </div>
            <div class="detail-item">
              <strong>Interpr√©tation jurisprudence:</strong>
              <span>{{ selectedDecision?.priseEnCompteInterpretationJurisprudentielle ? 'Oui' : 'Non' }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDecision?.droitsLibertes?.length">
          <h3>Droits et libert√©s invoqu√©s ({{ selectedDecision?.nombreDroitsLibertesInvoques }})</h3>
          <div class="rights-list">
            <div class="right-item" *ngFor="let droit of selectedDecision?.droitsLibertes">
              <strong>{{ droit.texte }}</strong>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDecision?.autresRemarques">
          <h3>Remarques</h3>
          <p>{{ selectedDecision?.autresRemarques }}</p>
        </div>

        <div class="detail-section">
          <h3>Caract√©ristiques</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>D√©cision notable:</strong>
              <span class="badge" [class.badge-success]="selectedDecision?.caractereNotableDecision">
                {{ selectedDecision?.caractereNotableDecision ? 'Oui' : 'Non' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
