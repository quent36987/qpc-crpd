
<div class="search-container">
  <div class="search-header">
    <h1>Recherche de D√©cisions de Filtrage QPC</h1>
    <p>Utilisez les filtres ci-dessous pour affiner votre recherche</p>
  </div>

  <div class="search-content" [class.results-view]="showResults">
    <form class="search-form" [class.collapsed]="showResults" (ngSubmit)="onSearch()">
      <div class="form-header" (click)="toggleForm()" *ngIf="showResults">
        <h2>Crit√®res de recherche</h2>
        <span class="toggle-icon">{{ formCollapsed ? '‚ñº' : '‚ñ≤' }}</span>
      </div>

      <div class="form-content" [class.hidden]="formCollapsed && showResults">
        <div class="form-row">
          <div class="form-group">
            <label>Num√©ro de d√©cision</label>
            <input type="text" [(ngModel)]="searchCriteria.numeroDecision" name="numeroDecision" placeholder="Ex: 24-10.001">
          </div>

          <div class="form-group">
            <label>R√©f√©rence</label>
            <input type="text" [(ngModel)]="searchCriteria.reference" name="reference" placeholder="Ex: 2024-QPC-001">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Juridiction</label>
            <app-multi-select
              [options]="options.juridictions"
              [(selectedItems)]="searchCriteria.juridictions"
              placeholder="S√©lectionner juridiction(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Niveau de filtrage</label>
            <app-multi-select
              [options]="options.niveauxFiltrage"
              [(selectedItems)]="searchCriteria.niveauxFiltrage"
              placeholder="S√©lectionner niveau(x)...">
            </app-multi-select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Date de filtrage - Du</label>
            <input
              type="date"
              [(ngModel)]="searchCriteria.dateFiltrageFrom"
              name="dateFiltrageFrom">
          </div>

          <div class="form-group">
            <label>Date de filtrage - Au</label>
            <input
              type="date"
              [(ngModel)]="searchCriteria.dateFiltrageTo"
              name="dateFiltrageTo">
          </div>
        </div>


        <div class="form-row">
          <div class="form-group">
            <label>Formation de jugement</label>
            <app-multi-select
              [options]="options.formationsJugement"
              [(selectedItems)]="searchCriteria.formationsJugement"
              placeholder="S√©lectionner formation(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Chambre ou section</label>
            <app-multi-select
              [options]="options.chambresSection"
              [(selectedItems)]="searchCriteria.chambresSousSectionIds"
              placeholder="S√©lectionner chambre(s)...">
            </app-multi-select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Num√©ro de sous-chambre</label>
            <app-multi-select
              [options]="options.numerosChambresReunies"
              [(selectedItems)]="searchCriteria.numerosChambresReuniesIds"
              placeholder="S√©lectionner num√©ro(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Application th√©orie changement circonstances</label>
            <app-multi-select
              [options]="options.applicationTheorieOptions"
              [(selectedItems)]="searchCriteria.applicationTheorieChangementCirconstancesIds"
              placeholder="S√©lectionner option(s)...">
            </app-multi-select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Origine juridictionnelle</label>
            <app-multi-select
              [options]="options.origines"
              [(selectedItems)]="selectedOrigines"
              placeholder="S√©lectionner origine(s)...">
            </app-multi-select>
          </div>

          <div class="form-group">
            <label>Mati√®re</label>
            <app-multi-select
              [options]="options.matieres"
              [(selectedItems)]="searchCriteria.matieresIds"
              placeholder="S√©lectionner mati√®re(s)...">
            </app-multi-select>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">üîç Rechercher</span>
            <span *ngIf="isLoading">Recherche en cours...</span>
          </button>
          <button type="button" class="btn-secondary" (click)="resetForm()" [disabled]="isLoading">
            ‚Ü∫ R√©initialiser
          </button>
        </div>
      </div>
    </form>

    <div class="results-section" *ngIf="showResults">
      <div class="results-header">
        <h2>R√©sultats de recherche</h2>
        <p class="results-count">{{ searchResult?.totalElements || 0 }} d√©cision(s) trouv√©e(s)</p>
      </div>

      <div class="table-container">
        <table class="results-table">
          <thead>
          <tr>
            <th>Num√©ro</th>
            <th>Juridiction</th>
            <th>Degr√© de filtrage
            <th>Date</th>
            <th>Niveau de filtrage</th>
            <th>Formation de jugement</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let decision of searchResult?.content || []">
            <td>{{ decision.numeroDecision }}</td>
            <td>{{ decision.juridiction }}</td>
            <td>{{ decision.ordreJuridictionnel }}</td>
            <td>{{ decision.dateFiltrage | date: 'dd/MM/yyyy' }}</td>
            <td>
<!--                    <span class="badge" [class.badge-success]="decision.niveauFiltrage === 'Renvoi'"-->
<!--                          [class.badge-warning]="decision.niveauFiltrage !== 'Renvoi'">-->
<!--                      {{ decision.niveauFiltrage }}-->
<!--                    </span>-->
              {{ decision.niveauFiltrage }}
            </td>
            <td>{{ decision.formationJugement }}</td>
            <td>
              <button class="btn-view" (click)="viewDetails(decision)">üëÅ Voir</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="searchResult">
        <button class="btn-page" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
          ‚Üê Pr√©c√©dent
        </button>
        <div class="page-info">
          Page {{ currentPage }} sur {{ totalPages() }}
        </div>
        <button class="btn-page" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages()">
          Suivant ‚Üí
        </button>
      </div>
    </div>
  </div>

  <div class="modal" *ngIf="selectedDecision" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>D√©tails de la d√©cision</h2>
        <button class="close-btn" (click)="closeDetails()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="detail-section">
          <h3>Informations g√©n√©rales</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Num√©ro:</strong>
              <span>{{ selectedDecision!.numeroDecision }}</span>
            </div>
            <div class="detail-item">
              <strong>R√©f√©rence:</strong>
              <span>{{ selectedDecision!.reference }}</span>
            </div>
            <div class="detail-item">
              <strong>Juridiction:</strong>
              <span>{{ selectedDecision!.juridiction }}</span>
            </div>
            <div class="detail-item">
              <strong>Date de filtrage:</strong>
              <span>{{ selectedDecision!.dateFiltrage | date: 'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <strong>Chambre/Section:</strong>
              <span>{{ selectedDecision!.chambreSousSection }}</span>
            </div>
            <div class="detail-item">
              <strong>Formation de jugement:</strong>
              <span>{{ selectedDecision!.formationJugement }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>D√©cision</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Niveau de filtrage:</strong>
<!--              <span class="badge" [class.badge-success]="selectedDecision()!.niveauFiltrage === 'Renvoi'"-->
<!--                    [class.badge-warning]="selectedDecision()!.niveauFiltrage !== 'Renvoi'">-->
<!--                    {{ selectedDecision()!.niveauFiltrage }}-->
<!--                  </span>-->
              <span class="detail-item">
                    {{ selectedDecision.niveauFiltrage }}
                  </span>
            </div>
            <div class="detail-item" *ngIf="selectedDecision.decisionRenvoi">
              <strong>D√©cision de renvoi:</strong>
              <span>{{ selectedDecision.decisionRenvoi }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDecision.decisionNonRenvoi">
              <strong>D√©cision de non-renvoi:</strong>
              <span>{{ selectedDecision.decisionNonRenvoi }}</span>
            </div>
            <div class="detail-item">
              <strong>Application th√©orie changement:</strong>
              <span>{{ selectedDecision.applicationTheorieChangementCirconstances }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Dispositions contest√©es</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>R√©f√©rence:</strong>
              <span>{{ selectedDecision.referenceDispositionsContestees }}</span>
            </div>
            <div class="detail-item">
              <strong>Loi d'origine:</strong>
              <span>{{ selectedDecision.loiOrigineDisposition }}</span>
            </div>
            <div class="detail-item">
              <strong>Mati√®re:</strong>
              <span>{{ selectedDecision.matiere }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Demandeur</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <strong>Identit√©:</strong>
              <span>{{ selectedDecision.identiteDemandeur }}</span>
            </div>
            <div class="detail-item">
              <strong>Qualit√©:</strong>
              <span>{{ selectedDecision.qualiteDemandeur }}</span>
            </div>
            <div class="detail-item">
              <strong>Qualit√© pr√©cise:</strong>
              <span>{{ selectedDecision.qualitePreciseDemandeur }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDecision.droitsLibertes.length > 0">
          <h3>Droits et libert√©s invoqu√©s</h3>
          <div class="rights-list">
            <div class="right-item" *ngFor="let droit of selectedDecision.droitsLibertes">
              <strong>{{ droit.texte }}</strong>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDecision.motsCles">
          <h3>Mots-cl√©s</h3>
          <div class="keywords">
                <span class="keyword" *ngFor="let keyword of selectedDecision.motsCles.split(',')">
                  {{ keyword.trim() }}
                </span>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDecision.autresRemarques">
          <h3>Remarques</h3>
          <p>{{ selectedDecision.autresRemarques }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
